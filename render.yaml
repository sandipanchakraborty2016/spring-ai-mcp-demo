services:
  # MCP Server - Provides tools via MCP protocol
  - type: web
    name: spring-ai-mcp-server
    runtime: docker
    dockerfilePath: ./mcp-server/Dockerfile
    dockerContext: ./mcp-server
    plan: free
    region: oregon
    branch: main
    envVars:
      - key: SERVER_PORT
        value: 8080
      - key: SPRING_PROFILES_ACTIVE
        value: production
    healthCheckPath: /health
    autoDeploy: true

  # MCP Host - AI chat with OpenAI + MCP tools
  - type: web
    name: spring-ai-mcp-host
    runtime: docker
    dockerfilePath: ./mcp-host/Dockerfile
    dockerContext: ./mcp-host
    plan: free
    region: oregon
    branch: main
    envVars:
      - key: SERVER_PORT
        value: 8082
      - key: SPRING_PROFILES_ACTIVE
        value: production
      - key: SPRING_AI_OPENAI_API_KEY
        sync: false  # Set this in Render dashboard
      - key: SPRING_AI_MCP_CLIENT_SSE_BASE_URL
        fromService:
          name: spring-ai-mcp-server
          type: web
          property: host
    healthCheckPath: /api/status
    autoDeploy: true
