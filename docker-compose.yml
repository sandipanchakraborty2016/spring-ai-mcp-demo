version: '3.8'

services:
  mcp-server:
    build: ./mcp-server
    container_name: mcp-server
    ports:
      - "8080:8080"
    environment:
      - SPRING_AI_MCP_SERVER_TRANSPORT=sse
      - SPRING_AI_MCP_SERVER_SSE_MESSAGE_ENDPOINT=/mcp/message
    networks:
      - mcp-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  mcp-client:
    build: ./mcp-client
    container_name: mcp-client
    ports:
      - "8081:8081"
    environment:
      - SPRING_AI_MCP_CLIENT_TRANSPORT=sse
      - SPRING_AI_MCP_CLIENT_SSE_BASE_URL=http://mcp-server:8080
      - SPRING_AI_MCP_CLIENT_SSE_MESSAGE_ENDPOINT=/mcp/message
    depends_on:
      - mcp-server
    networks:
      - mcp-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8081/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  mcp-host:
    build: ./mcp-host
    container_name: mcp-host
    ports:
      - "8082:8082"
    environment:
      - SPRING_AI_MCP_CLIENT_TRANSPORT=sse
      - SPRING_AI_MCP_CLIENT_SSE_BASE_URL=http://mcp-server:8080
      - SPRING_AI_MCP_CLIENT_SSE_MESSAGE_ENDPOINT=/mcp/message
      - SPRING_AI_OPENAI_API_KEY=${SPRING_AI_OPENAI_API_KEY:-demo-key}
    depends_on:
      - mcp-server
    networks:
      - mcp-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8082/health"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  mcp-network:
    driver: bridge
